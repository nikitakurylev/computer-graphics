#pragma once
#include "BTNode.h"

// ============================================================================
// BTDecorator.h
// Базовый класс для декораторов (узлов с одним ребенком)
// ============================================================================

namespace AI {

    // ------------------------------------------------------------------------
    // BTDecorator - узел-обертка с одним дочерним узлом
    // 
    // Декораторы модифицируют поведение своего ребенка:
    // - Изменяют результат (Inverter)
    // - Повторяют выполнение (Repeat)
    // - Добавляют условия (UntilSuccess)
    // 
    // Наследники: Repeat, Inverter, RetryUntilSuccess
    // ------------------------------------------------------------------------
    class BTDecorator : public BTNode {
    public:
        BTDecorator(const std::string& name = "Decorator")
            : BTNode(name), child(nullptr) {
        }

        virtual ~BTDecorator() = default;

        // --------------------------------------------------------------------
        // Установить дочерний узел
        // 
        // Пример:
        // auto inverter = std::make_shared<BTInverter>("InvertHealth");
        // inverter->SetChild(std::make_shared<CheckHealthAction>());
        // --------------------------------------------------------------------
        void SetChild(BTNodePtr childNode) {
            child = childNode;
        }

        // --------------------------------------------------------------------
        // Получить дочерний узел
        // --------------------------------------------------------------------
        BTNodePtr GetChild() const {
            return child;
        }

        // --------------------------------------------------------------------
        // Проверить, есть ли ребенок
        // --------------------------------------------------------------------
        bool HasChild() const {
            return child != nullptr;
        }

        // --------------------------------------------------------------------
        // Сброс состояния - сбрасываем и ребенка
        // --------------------------------------------------------------------
        void Reset() override {
            BTNode::Reset();
            if (child) {
                child->Reset();
            }
        }

    protected:
        // --------------------------------------------------------------------
        // При прерывании - прерываем ребенка
        // --------------------------------------------------------------------
        void OnAbort(GameObject* gameObject, Blackboard* blackboard) override {
            if (child && child->IsRunning()) {
                child->Abort(gameObject, blackboard);
            }
        }

    protected:
        BTNodePtr child;  // Единственный дочерний узел
    };

} // namespace AI